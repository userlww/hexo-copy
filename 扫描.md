---
title: 扫描
date: 2017-12-04 21:54:59
tags: 网络安全
categories: 网络安全

---
#### 扫描的基本步骤
>      1.确定目标系统是否真实存在
>      2.确定目标系统上那些服务正在运行或监听
>      3.探查操作系统
#### 确定目标系统是否真实存在的方法
>  （传统意义上）ping：向目标发ICMP ECHO(类型8）数据包，如返回ICMP_REPLY数据包（类型0），说明目标系统真实存在
&nbsp;&nbsp;&nbsp;（现在的)ping:可利用ICMP，TCP，UDP   
&nbsp;&nbsp;&nbsp;Q:目标站点阻断了ICMP数据包怎么办
&nbsp;&nbsp;&nbsp;A：使用TCP，UDP进行扫描
&nbsp;&nbsp;&nbsp;nmap-PT：对“-PT”选项指定端口进行TCP ping扫描；向目标主机发送TCP ACK数据包并根据返回的RST数据包判断活跃主机
Q：为什么选用发送ACK数据包
A：绝大多数无状态防火墙产品通常会放行ACK数据包
确定目标系统上那些服务正在运行或监听

###端口扫描:
&nbsp;&nbsp;&nbsp;&nbsp;主动连接目标系统的TCP和UDP端口以确定那些服务正在运行或处于监听状态
#### 主要目的：

>          确定运行的TCP/UDP服务
>          确定操作系统的具体类型
>          确定提供服务的应用程序名称和版本
#### TCP的6个标志位

>          URG：紧急数据包
>          ACK：确认
>          PSH：请求急迫操作；接收方应该尽快将数据包交给应用层
>          RST：连接复位:重建连接
>          SYN：连接请求
>          FIN：结束
#### TCP/IP的一些实现原则

>          SYN或FIN数据包到达一关闭的端口,丢失数据包同时发送一个RST数据包
>          RST数据包到达一监听端口，RST被丢弃
>          包含ACK的数据包到达一个监听端口时，数据包被丢弃，同时发送一个RST数据包
>          一个不包含SYN位的数据包到达一个监听端口时，数据包被丢弃
>          SYN数据包到达一个监听端口时，数据包被丢弃
>          FIN数据包到达一个监听端口时，正常的三握手阶段继续，回答一个SYN|ACK数据包
>          FIN数据包到达一个监听端口时，数据包被丢弃
#### 扫描类型
##### TCP连接扫描（namp —sT)：
       连接目标端口并完成一次完整的三握手过程：很容易被目标系统觉察
![此处输入图片的描述][1]


  [1]: http://ww4.sinaimg.cn/large/0060lm7Tly1fm3vyorx9kj30iu0asq3x.jpg
##### TCP SYN扫描（半开扫描 nmap -sS):
> 向目标端口发送SYN数据包

>           返回SYN/ACK数据包，可以断定该端口处于监听状态
>           返回RST/ACK数据包，通常表示该端口不在监听状态
>           然后扫描者送出一个RST/ACK数据包（使通信双方永远不会建立一条完整连接）
##### TCP FIN扫描(秘密扫描;nmap -sF): 
>向目标端口发送FIN数据包

>        如果目标端口关闭，目标系统应该返回一个RST数据包，否则丢弃该包。通常只对UNIX系统的TCP/IP栈有>效（Window平台总是返回RST包）
>        由于不包含TCP三次握手协议的任何部分，所以无法被记录下来，从而比SYN扫描隐蔽
>        FIN数据包能通过监测SYN包的包过滤器(秘密扫描)

>         秘密扫描的两个变体：
>            TCP Xmas扫描（圣诞树扫描;nmap -sX）: TCP包包头设置所有标志位目标端口关闭，目标系统应该返回一个RST数据包
>            TCP Null扫描（空扫描;nmap -sN）: 关掉所有的标志目标端口关闭，目标系统应该返回一个RST数据包

>    Remark：使用这些组合的目的是通过FIN标记监测器的过滤
>    Remark：主要用于UNIX/Linux/BSD的TCP/IP的协议栈；不适用于Windows系统

##### TCP ACK扫描(nmap-sA)：
>    测试防火墙的规则集。判断防火墙是简单的包过滤防火墙；还是高级的、具备数据包过滤功能的状态（sta>teful）防火墙
>   不能用来确定端口是否开放或者关闭
##### TCP窗口扫描(nmap -sW):
>    测试特定目标系统（如AIX和FreeBSD系统）上的端口是否开放、被过滤——会导致目标系统返回不同的TCP窗口长度值
##### TCP Maimon扫描(nmap -sM)：
>   探测报文改为FIN/ACK外，其原理与TCPFIN扫描一样；无论端口是否开放，都应响应RST报文。Uriel注意到如果端口开放，许多基于BSD的系统只是丢弃该报文
##### UDP扫描(nmap -sU)：
>  向目标端口发出UDP数据包
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如果返回“ICMP port unreachable” 出错消息，表明端口关闭
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如果没有收到该消息，端口可能开放
remark：UDP不要求必须建立一条连接，所以扫描的准确性取决于与目标网络的使用情况和过滤机制有关的许多因素（扫描结果不可靠）
